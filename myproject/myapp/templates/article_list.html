{% extends 'base.html' %}
{% load static %}
{% block content %}
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background: linear-gradient(120deg, #fdfcfb, #e2d1c3);
      color: #333;
  }

  .div2 {
    margin: 0;
    padding: 10px ;
    max-width: 100%;
  }

  /* Top Action Buttons */
  .button-link {
    display: inline-block;
    padding: 10px 20px;
    background: linear-gradient(135deg, #234791ff, #2a5298);
    color: #fff;
    border-radius: 30px;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    margin: 10px;
   
  }

  .button-link:hover {
    background: linear-gradient(135deg, #294a7eff, #4069b0);
    transform: translateY(-2px);
    box-shadow: 0 6px 18px rgba(0,0,0,0.25);
  }

  /* Search Bar */
  .search-bar {
    margin: 10px 0;
    gap: 10px;
    display: flex;
    justify-content: center;
    align-items: center;

    
  }

  .search-bar input[type="text"] {
    padding: 10px 20px;
    width: 300px;
    border: none;
    border-radius: 25px;
    font-size: 15px;
    background: rgba(255,255,255,0.9);
    box-shadow: inset 2px 2px 6px rgba(163, 163, 163, 1),
                inset -2px -2px 6px rgba(206, 200, 200, 0.8);
  }

  .search-bar button {
    padding: 10px 20px;
    border-radius: 25px;
    border: none;
    cursor: pointer;

    background: linear-gradient(135deg, #2e508dff, #2d5cadff);
    color: #fff;
    font-weight: 600;
    box-shadow: 0 4px 12px rgba(211, 208, 208, 0.15);
  }


  .search-bar button:hover {
    background: linear-gradient(135deg, #1e4686ff, #254379ff);
  }

  /* Main Layout */
  .layout {
    display: grid;
    grid-template-columns: 250px 1fr;
    max-width: 100%; /* full width */
    width: 100%;
    max-width: 100%;

    gap: 20px;
  }
  
  /* Sidebar */
  .tag-sidebar {
    background: rgba(255,255,255,0.8);
    padding: 15px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  }
  .tag-sidebar h3 {
    margin-top: 0;
    font-size: 18px;
    color: #36445eff;
    border-bottom: 2px solid #ddd;
    padding-bottom: 8px;
  }
  .tag-sidebar li {
    margin: 10px 0;
  }
  .tag-sidebar a {
    text-decoration: none;
    font-weight: 500;
    color: #31476bff;
  }
  .tag-sidebar a:hover {
    color: #3e5785ff;
    text-decoration: underline;
  }

  /* Articles */
  .article-container {
    display: flex;
    flex-direction: column;
    gap: 13px;
  }
  .article-card {
    padding: 20px ;
    border-radius: 15px;
    background: rgba(255,255,255,0.9);
    box-shadow: 0 6px 15px rgba(0,0,0,0.12);
  }
 


  .article-card h4 {
    margin: 0 0 10px;
    font-size: 25px;
    color: #3f495aff;
  }
  .article-card p {
    margin: 5px ;
    line-height: 1.5;
    color: #555;
  }
  .article-card span {
    display: inline-block;
    background: #e6f0ff;
    padding: 5px 10px;
    border-radius: 15px;
    font-size: 13px;
    margin: 3px 5px 3px 0;
    color: #2a5298;
    font-weight: 500;
  }

  /* Like Button */
  .like-btn {
    background: linear-gradient(135deg, #ff6b6b, #a30808ff);
    border: none;
    padding: 8px 16px;
    border-radius: 20px;
    color: white;
    cursor: pointer;
    font-size: 13px;
    margin-right: 10px;
  }
  .like-btn:hover {
    background: linear-gradient(135deg, #ff4b4b, #8f0909ff);
  }

  /* Comments Section */
  .comments-btn {
    background: #334f81ff;
    color: white;
    border: none;
    padding: 6px 12px;
    border-radius: 15px;
    cursor: pointer;
    font-size: 12px;
    margin-top: 10px;
    transition: 0.3s;
  }
  .comments-btn:hover {
    background: #2a5298;
  }
  .comments-list {
    font-size: 14px;
  }

  /* Pagination */
  .pagination {
    margin: 30px 0;
    text-align: center;
  }
  .button-link2 {
    padding: 10px 16px;
    margin: 4px;
    background: linear-gradient(135deg, #1e3c72, #2a5298);
    color: #fff;
    border-radius: 25px;
    text-decoration: none;
    font-size: 14px;
    font-weight: 600;
    transition: 0.3s;
  }
  .button-link2:hover {
    background: linear-gradient(135deg, #23395d, #4069b0);
    transform: translateY(-2px);
  }
    .underline-link {
    text-decoration: underline;
    color: #3b64a1ff;
    margin-left: 100px;
  }
    .like-list {
    margin-top: 5px;
    padding: 5px;
    border: 1px solid #ccc;
    background: #f9f9f9;
  }
.like-list, 
.comments-list {
  max-height: 150px;
  overflow-y: auto;    /* üëà vertical scroll bar aayegi */
  border: 1px solid #ccc;
  padding: 5px;
  margin-top: 5px;
  border-radius: 4px;
  background: #f9f9f9;
  .like-list::-webkit-scrollbar,
  .comments-list::-webkit-scrollbar {
    width: 8px;
  }

  .like-list::-webkit-scrollbar-thumb,
  .comments-list::-webkit-scrollbar-thumb {
    background-color: rgba(90, 90, 90, 0.4);
    border-radius: 4px;
  }

  .like-list::-webkit-scrollbar-thumb:hover,
  .comments-list::-webkit-scrollbar-thumb:hover {
    background-color: rgba(90, 90, 90, 0.6);
  }

}
  /* Mobile */
  @media (max-width: 900px) {
    .layout {
      grid-template-columns: 1fr;
    }
  }
</style>
<div class="div2">
<div id="article-list-container">
  
  {% if user.is_authenticated %}
  <div class="button-3">
    <a href="{% url 'create_article' %}" class="button-link" id="create-article-link">Create a New Article</a>
    <a href="{% url 'logout' %}" class="button-link" id="logout-link">Logout</a>
    <a href="{% url 'draft_list' %}" class="button-link" id="draft-link">My Draft</a>
  </div>
  {% else %}
    <a href="{% url 'login' %}" class="button-link" id="login-link">Login</a>
    <a href="{% url 'register' %}" class="button-link" id="register-link">Register</a>
  {% endif %}


  <div class="search-bar" >
    <a href="{% url 'article_list' %}" class="underline-link" ><h2>All Articles</h2></a>
    <input type="text" id="author-search" placeholder="Search by author..."value="{{ request.GET.author|default:'' }}">
    <button id="author-search-btn" class="button-link">Search</button>
  </div>

  <div class="layout">
    <div class="tag-sidebar">
      <h3>Filter by Tag</h3>
      <ul>
        {% for tag, count in tag_list %}
          <li>
            <a href="?tag={{ tag }}">({{ count }}) {{ tag }} </a>  
          </li>
        {% endfor %}
      </ul>
      {% if selected_tag %}
        <a href="{% url 'article_list' %}">‚Üê Show All Articles</a>
      {% endif %}
    </div>

    <div class="article-container">
      {% for article in articles %}
        <div class="article-card" data-id="{{ article.id }}">
          <h4> {{ article.title }}</h4>
          <p id="short-{{ article.id }}">
            {{ article.content|slice:":900" }}...
            <a href="#" class="more-link" data-id="{{ article.id }}">more</a>
          </p>

          <p id="full-{{ article.id }}" style="display:none;">
            {{ article.content }}
            <a href="#" class="less-link" data-id="{{ article.id }}">Less</a>
          </p>

          <p>
            {% for tag in article.tag_list %}
              <span>{{ tag }}</span>{% if not forloop.last %}, {% endif %}
            {% endfor %}<br>
          </p><br>
          <p>{{ article.created_at|date:"d M Y, H:i" }} | <strong style="color:#23395d">{{ article.author.username }}</strong></p>

          {% if user.is_authenticated %}
          <button class="like-btn" data-article="{{ article.id }}">
            {% if article.id in liked_articles %}
              Liked
            {% else %}
              Like
            {% endif %}
          </button>
          {% else %}
            Login : 
        {% endif %}
        <button class="like-count" id="like-count-{{ article.id }}" data-article="{{ article.id }}">
          {{ article.like_set.count|default:"0" }} 
        </button>

        <div class="like-list" id="like-list-{{ article.id }}" style="display:none;">
          
            {% if article.like_set.count == 0 %}
              <li id="no-likes-{{ article.id }}">No likes yet</li>
            {% endif %}
      

            {% for like in article.like_set.all %}
              <li id="like-user-{{ like.user.id }}">
               <strong> {{ like.user.username }}</strong>: 
                <small>{{ like.created_at|date:"d M Y, H:i" }}</small>
              </li>
            {% endfor %}
        </div>
  
          <div class="comments-section">
            <button class="comments-btn" data-article="{{ article.id }}">comments</button>
            <span class="comments-count" id="comments-count-{{ article.id }}">
              {{ article.comments.count|default:"0" }}
            </span>

            <div class="comments-section" id="comments-section-{{ article.id }}" style="display:none;  border:1px solid #ddd; padding:10px;">
              
              {% if user.is_authenticated %}
                <div class="add-comment">
                  <textarea id="comment-input-{{ article.id }}" placeholder="Write a comment..." rows="1" style="width:100%;"></textarea>
                  <button class="submit-comment-btn" data-article="{{ article.id }}">Send</button>
                </div>
              {% endif %}

              <div class="comments-list" id="comments-list-{{ article.id }}">
                {% for comment in article.comments.all %}
                  <div class="comment"><strong>{{ comment.user.username }}:</strong> {{ comment.content }}</div>
                {% endfor %}
              </div>
            </div>
          </div> 
        </div>
      {% empty %}
        <p>No articles found.</p>
      {% endfor %}
    </div>
  </div>

</div>

  <div class="pagination" style="text-align:center; margin-top:20px;">
  {% if page_obj.has_previous %}
    <a href="?page={{ page_obj.previous_page_number }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if author_name %}&author={{ author_name }}{% endif %}" class="button-link2">Previous</a>
  {% endif %}

  {% for num in page_obj.paginator.page_range %}
    {% if page_obj.number == num %}
      <span class="button-link2" >{{ num }}</span>
    {% else %}
      <a href="?page={{ num }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if author_name %}&author={{ author_name }}{% endif %}" class="button-link2">{{ num }}</a>
    {% endif %}
  {% endfor %}

  {% if page_obj.has_next %}
    <a href="?page={{ page_obj.next_page_number }}{% if selected_tag %}&tag={{ selected_tag }}{% endif %}{% if author_name %}&author={{ author_name }}{% endif %}" class="button-link2">Next</a>
  {% endif %}
  </div>
</div>
{% endblock %}










